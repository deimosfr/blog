

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.26 with theme Tranquilpeak 0.4.0-BETA">
    <title>Deploy Kubernetes with Ansible</title>
    <meta name="author" content="Pierre Mavro / Deimosfr">
    <meta name="keywords" content="">

    <link rel="icon" href="https://blog.deimos.fr/favicon.png">
    

    
    <meta name="description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">
    <meta property="og:description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Deploy Kubernetes with Ansible">
    <meta property="og:url" content="/2017/04/18/deploy-kubernetes-with-ansible/">
    <meta property="og:site_name" content="Deimosfr Blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Deimosfr Blog">
    <meta name="twitter:description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">
    
      <meta name="twitter:creator" content="@deimosfr">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=640">
    

    
      <meta property="og:image" content="https://blog.deimos.fr/thumbnails/logo_kubernetes.png">
    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://blog.deimos.fr/css/style-fpbzgxsy0kgmdvyrj5ykkg6ratccrk3gocmaqn4xpcjywmv5dteilzucro4f.min.css" />
    
    
      
        <link rel="stylesheet" href="https://blog.deimos.fr/css/custom.css">
      
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63927289-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://blog.deimos.fr/">Deimosfr Blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://blog.deimos.fr/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://blog.deimos.fr/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Pierre Mavro / Deimosfr</h4>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.deimos.fr" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-user"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://wiki.deimos.fr" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-wikipedia-w"></i>
      
      <span class="sidebar-button-desc">Wiki</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Deploy Kubernetes with Ansible
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2017-04-18T20:18:07&#43;02:00">
        
  
  
  
  
    18 April 2017
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://blog.deimos.fr/categories/ansible">Ansible</a>, 
    
      <a class="category-link" href="https://blog.deimos.fr/categories/cloud">Cloud</a>, 
    
      <a class="category-link" href="https://blog.deimos.fr/categories/kubernetes">Kubernetes</a>
    
  


  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p><img src="https://blog.deimos.fr/images/logo_kubernetes.png" alt="Kubernetes" /></p>

<p><a href="https://kubernetes.io/" target="_blank">Kubernetes</a> is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for <a href="https://www.nousmotards.com" target="_blank">Nousmotards</a> and decided to build an <a href="https://galaxy.ansible.com/deimosfr/coreos-kubernetes/" target="_blank">Ansible role</a> for it to make it simpler to deploy.</p>

<p>Why did I built it as other projects like <a href="https://github.com/kubernetes-incubator/kargo" target="_blank">Kargo</a> already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:</p>

<script type="text/javascript" src="https://asciinema.org/a/97170.js" id="asciicast-97170" async></script>

<p>This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages. The features are:</p>

<ul>
<li>Manage SSL certificats</li>
<li>Configuration changes made easy (all in config)</li>
<li>Lot of checks during playbook run</li>
<li>Manage Kubernetes upgrades</li>
<li>Deploy Kubernetes DNS and Dashboard</li>
</ul>

<p>If you want to know more on CoreOS installation with ansible, you can <a href="https://blog.deimos.fr/2016/09/30/deploy-coreos-with-ansible/" target="_blank">look at the previous post</a>.</p>

<p>If you look at the configuration, it could looks like big, but in fact it&rsquo;s not so complicated if you&rsquo;re a little bit familiar with Kubernetes:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #ae81ff">k8s_version</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;v1.5.1_coreos.0&#39;</span>
<span style="color: #ae81ff">k8s_dashboard_version</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;1.5.0&#39;</span>

<span style="color: #75715e"># Master host will ideally be a network load balancer that sits in front of</span>
<span style="color: #75715e"># them. Alternatively, a DNS name can be configured which will resolve to</span>
<span style="color: #75715e"># the master IPs</span>
<span style="color: #ae81ff">k8s_master_host</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;kub-master-host.myfqdn.com&#39;</span>
<span style="color: #ae81ff">k8s_etcd_endpoints</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;http://{{</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">groups[&#39;k8s-masters&#39;]</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">|</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">map(&#39;extract&#39;,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">hostvars,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">[&#39;priv_ip&#39;])</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">|</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">join(&#39;:2379,http://&#39;)</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">}}:2379&quot;</span>
<span style="color: #ae81ff">k8s_flanneld_subnet</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;10.1.0.0/16&quot;</span>
<span style="color: #ae81ff">k8s_pod_network</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;10.2.0.0/16&#39;</span>
<span style="color: #ae81ff">k8s_service_ip_range</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;10.3.0.0/24&#39;</span>
<span style="color: #ae81ff">k8s_service_ip</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;10.3.0.1&#39;</span>
<span style="color: #ae81ff">k8s_dns_service_ip</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;10.3.0.10&#39;</span>
<span style="color: #ae81ff">k8s_cluster_domain</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;cluster.local&#39;</span>
<span style="color: #ae81ff">k8s_kubectl_cluster_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;default-cluster&#39;</span>

<span style="color: #ae81ff">k8s_adverstise_ip</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{ansible_enp0s8.ipv4.address}}&quot;</span>
<span style="color: #75715e"># Leave it blank if you&#39;re using flannel, otherwize use cni for Calico</span>
<span style="color: #ae81ff">k8s_kublet_network_plugin</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;&#39;</span>
<span style="color: #75715e"># Set to false by default because kubelet-wrapper will handle it</span>
<span style="color: #ae81ff">k8s_restart_kubelet</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">false</span>

<span style="color: #75715e"># SSL</span>

<span style="color: #ae81ff">k8s_role_path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;roles/deimosfr.coreos-kubernetes&quot;</span>
<span style="color: #ae81ff">k8s_template_dir</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{k8s_role_path}}/templates&quot;</span>
<span style="color: #ae81ff">k8s_ssl_local_path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{k8s_role_path}}/files/ssl/{{k8s_kubectl_cluster_name}}&quot;</span>
<span style="color: #ae81ff">k8s_ssl_api_server_path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{k8s_ssl_local_path}}/api_servers&quot;</span>
<span style="color: #ae81ff">k8s_ssl_workers_path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{k8s_ssl_local_path}}/workers&quot;</span>
<span style="color: #ae81ff">k8s_ssl_admin_path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{k8s_ssl_local_path}}/admins&quot;</span>

<span style="color: #ae81ff">k8s_ssl_bytes_encrypt</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">2048</span>
<span style="color: #ae81ff">k8s_ssl_ca_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;ca-key.pem&#39;</span>
<span style="color: #ae81ff">k8s_ssl_ca_pem_key_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;ca.pem&#39;</span>
<span style="color: #ae81ff">k8s_ssl_valid_days</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10000</span>
<span style="color: #ae81ff">k8s_ssl_ca_pem_subj</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;/CN=kube-ca&#39;</span>

<span style="color: #ae81ff">k8s_ssl_apiserver_key_pem_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;apiserver-key.pem&#39;</span>
<span style="color: #ae81ff">k8s_ssl_apiserver_csr_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;apiserver.csr&#39;</span>
<span style="color: #ae81ff">k8s_ssl_apiserver_subj</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;/CN=kube-apiserver&#39;</span>
<span style="color: #ae81ff">k8s_ssl_apiserver_pem_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;apiserver.pem&#39;</span>
<span style="color: #ae81ff">k8s_ssl_apiserver_days</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10000</span>

<span style="color: #ae81ff">k8s_openssl_config</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">req</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">req_extensions</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;v3_req&#39;</span>
    <span style="color: #ae81ff">distinguished_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;req_distinguished_name&#39;</span>
  <span style="color: #ae81ff">req_distinguished_name</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">v3_req</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">basicConstraints</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;CA:FALSE&#39;</span>
    <span style="color: #ae81ff">keyUsage</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;nonRepudiation,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">digitalSignature,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">keyEncipherment&#39;</span>
    <span style="color: #ae81ff">subjectAltName</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;@alt_names&#39;</span>
  <span style="color: #ae81ff">alt_names</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">DNS</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">kubernetes</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">kubernetes.default</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">kubernetes.default.svc</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #e6db74">&quot;kubernetes.default.svc.{{k8s_cluster_domain}}&quot;</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #e6db74">&quot;*.myfqdn.com&quot;</span>
    <span style="color: #75715e"># Do not fulfil IP of master nodes, they&#39;ll be automatically generated</span>
    <span style="color: #75715e"># from k8s-masters group</span>
    <span style="color: #ae81ff">IP</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #e6db74">&quot;{{k8s_service_ip}}&quot;</span>

<span style="color: #ae81ff">k8s_workers_openssl_config</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">req</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">req_extensions</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;v3_req&#39;</span>
    <span style="color: #ae81ff">distinguished_name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;req_distinguished_name&#39;</span>
  <span style="color: #ae81ff">req_distinguished_name</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">v3_req</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">basicConstraints</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;CA:FALSE&#39;</span>
    <span style="color: #ae81ff">keyUsage</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;nonRepudiation,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">digitalSignature,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">keyEncipherment&#39;</span>
    <span style="color: #ae81ff">subjectAltName</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;@alt_names&#39;</span>
  <span style="color: #75715e"># Do not fulfil alt_names, it will automatically be generated</span>
  <span style="color: #ae81ff">alt_names</span><span style="color: #f8f8f2">:</span>

<span style="color: #ae81ff">k8s_kube_apiserver</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Pod</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-apiserver</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">hostNetwork</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-apiserver</span>
      <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;quay.io/coreos/hyperkube:{{k8s_version}}&quot;</span>
      <span style="color: #ae81ff">command</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">/hyperkube</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">apiserver</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--bind-address=0.0.0.0</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--etcd-servers={{k8s_etcd_endpoints}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--allow-privileged=true</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--service-cluster-ip-range={{k8s_service_ip_range}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--secure-port=443</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--advertise-address={{k8s_adverstise_ip}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--tls-cert-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_pem_name}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--tls-private-key-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_key_pem_name}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--client-ca-file=/etc/kubernetes/ssl/{{k8s_ssl_ca_pem_key_name}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--service-account-key-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_key_pem_name}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--runtime-config=extensions/v1beta1=true,extensions/v1beta1/networkpolicies=true</span>
      <span style="color: #ae81ff">livenessProbe</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">host</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">127.0.0.1</span>
          <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8080</span>
          <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/healthz</span>
        <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">15</span>
        <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">15</span>
      <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">443</span>
        <span style="color: #ae81ff">hostPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">443</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">https</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8080</span>
        <span style="color: #ae81ff">hostPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8080</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">local</span>
      <span style="color: #ae81ff">volumeMounts</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-kubernetes</span>
        <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/ssl/certs</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-host</span>
        <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">volumes</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl</span>
      <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-kubernetes</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/usr/share/ca-certificates</span>
      <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-host</span>

<span style="color: #ae81ff">k8s_kube_proxy_masters</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Pod</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-proxy</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">hostNetwork</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-proxy</span>
      <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;quay.io/coreos/hyperkube:{{k8s_version}}&quot;</span>
      <span style="color: #ae81ff">command</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">/hyperkube</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">proxy</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--master=http://127.0.0.1:8080</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--proxy-mode=iptables</span>
      <span style="color: #ae81ff">securityContext</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">privileged</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
      <span style="color: #ae81ff">volumeMounts</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/ssl/certs</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-host</span>
        <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">volumes</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/usr/share/ca-certificates</span>
      <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-host</span>

<span style="color: #ae81ff">k8s_kube_proxy_workers</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Pod</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-proxy</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">hostNetwork</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-proxy</span>
      <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;quay.io/coreos/hyperkube:{{k8s_version}}&quot;</span>
      <span style="color: #ae81ff">command</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">/hyperkube</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">proxy</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--master=https://{{k8s_master_host}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--kubeconfig=/etc/kubernetes/worker-kubeconfig.yaml</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--proxy-mode=iptables</span>
      <span style="color: #ae81ff">securityContext</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">privileged</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
      <span style="color: #ae81ff">volumeMounts</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/ssl/certs</span>
          <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;ssl-certs&quot;</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/worker-kubeconfig.yaml</span>
          <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;kubeconfig&quot;</span>
          <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl</span>
          <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;etc-kube-ssl&quot;</span>
          <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">volumes</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;ssl-certs&quot;</span>
        <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;/usr/share/ca-certificates&quot;</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;kubeconfig&quot;</span>
        <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;/etc/kubernetes/worker-kubeconfig.yaml&quot;</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;etc-kube-ssl&quot;</span>
        <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;/etc/kubernetes/ssl&quot;</span>

<span style="color: #ae81ff">k8s_kube_controller_manager</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Pod</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-controller-manager</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">hostNetwork</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-controller-manager</span>
      <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;quay.io/coreos/hyperkube:{{k8s_version}}&quot;</span>
      <span style="color: #ae81ff">command</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">/hyperkube</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">controller-manager</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--master=http://127.0.0.1:8080</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--leader-elect=true</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--service-account-private-key-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_key_pem_name}}</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--root-ca-file=/etc/kubernetes/ssl/{{k8s_ssl_ca_pem_key_name}}</span>
      <span style="color: #ae81ff">livenessProbe</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">host</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">127.0.0.1</span>
          <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/healthz</span>
          <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10252</span>
        <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">15</span>
        <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>
      <span style="color: #ae81ff">volumeMounts</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-kubernetes</span>
        <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">mountPath</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/ssl/certs</span>
        <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-host</span>
        <span style="color: #ae81ff">readOnly</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">volumes</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl</span>
      <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-kubernetes</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">hostPath</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/usr/share/ca-certificates</span>
      <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ssl-certs-host</span>

<span style="color: #ae81ff">k8s_kube_scheduler</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Pod</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-scheduler</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">hostNetwork</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">true</span>
    <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-scheduler</span>
      <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;quay.io/coreos/hyperkube:{{k8s_version}}&quot;</span>
      <span style="color: #ae81ff">command</span><span style="color: #f8f8f2">:</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">/hyperkube</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">scheduler</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--master=http://127.0.0.1:8080</span>
      <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--leader-elect=true</span>
      <span style="color: #ae81ff">livenessProbe</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">host</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">127.0.0.1</span>
          <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/healthz</span>
          <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10251</span>
        <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">15</span>
        <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>

<span style="color: #ae81ff">k8s_worker_kubeconfig</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Config</span>
  <span style="color: #ae81ff">clusters</span><span style="color: #f8f8f2">:</span>
  <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">local</span>
    <span style="color: #ae81ff">cluster</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">certificate-authority</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl/ca.pem</span>
      <span style="color: #ae81ff">server</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;https://{{k8s_master_host}}:443&quot;</span>
  <span style="color: #ae81ff">users</span><span style="color: #f8f8f2">:</span>
  <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubelet</span>
    <span style="color: #ae81ff">user</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">client-certificate</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl/worker.pem</span>
      <span style="color: #ae81ff">client-key</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/etc/kubernetes/ssl/worker-key.pem</span>
  <span style="color: #ae81ff">contexts</span><span style="color: #f8f8f2">:</span>
  <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">context</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">cluster</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">local</span>
      <span style="color: #ae81ff">user</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubelet</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubelet-context</span>
  <span style="color: #ae81ff">current-context</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubelet-context</span>

<span style="color: #75715e"># 3rd party apps</span>

<span style="color: #ae81ff">k8s_dns_service</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Service</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
    <span style="color: #ae81ff">labels</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns</span>
      <span style="color: #ae81ff">kubernetes.io/cluster-service</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;true&quot;</span>
      <span style="color: #ae81ff">kubernetes.io/name</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;KubeDNS&quot;</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">selector</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns</span>
    <span style="color: #ae81ff">clusterIP</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{{k8s_dns_service_ip}}&quot;</span>
    <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dns</span>
      <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">53</span>
      <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">UDP</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dns-tcp</span>
      <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">53</span>
      <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">TCP</span>

<span style="color: #ae81ff">k8s_dns_replication_controller</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">ReplicationController</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns-v20</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
    <span style="color: #ae81ff">labels</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns</span>
      <span style="color: #ae81ff">version</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v20</span>
      <span style="color: #ae81ff">kubernetes.io/cluster-service</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;true&quot;</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">replicas</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>
    <span style="color: #ae81ff">selector</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns</span>
      <span style="color: #ae81ff">version</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v20</span>
    <span style="color: #ae81ff">template</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">labels</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-dns</span>
          <span style="color: #ae81ff">version</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v20</span>
        <span style="color: #ae81ff">annotations</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">scheduler.alpha.kubernetes.io/critical-pod</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;&#39;</span>
          <span style="color: #ae81ff">scheduler.alpha.kubernetes.io/tolerations</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&#39;[{&quot;key&quot;:&quot;CriticalAddonsOnly&quot;,</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;operator&quot;:&quot;Exists&quot;}]&#39;</span>
      <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubedns</span>
          <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">gcr.io/google_containers/kubedns-amd64:1.9</span>
          <span style="color: #ae81ff">resources</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">limits</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">170Mi</span>
            <span style="color: #ae81ff">requests</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">cpu</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">100m</span>
              <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">70Mi</span>
          <span style="color: #ae81ff">livenessProbe</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/healthz-kubedns</span>
              <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8080</span>
              <span style="color: #ae81ff">scheme</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">HTTP</span>
            <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">60</span>
            <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
            <span style="color: #ae81ff">successThreshold</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>
            <span style="color: #ae81ff">failureThreshold</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
          <span style="color: #ae81ff">readinessProbe</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/readiness</span>
              <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8081</span>
              <span style="color: #ae81ff">scheme</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">HTTP</span>
            <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">3</span>
            <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
          <span style="color: #ae81ff">args</span><span style="color: #f8f8f2">:</span>
            <span style="color: #f8f8f2">-</span> <span style="color: #e6db74">&quot;--domain={{k8s_cluster_domain}}.&quot;</span>
            <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--dns-port=10053</span>
          <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10053</span>
            <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dns-local</span>
            <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">UDP</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10053</span>
            <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dns-tcp-local</span>
            <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">TCP</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dnsmasq</span>
          <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">gcr.io/google_containers/kube-dnsmasq-amd64:1.4</span>
          <span style="color: #ae81ff">livenessProbe</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/healthz-dnsmasq</span>
              <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8080</span>
              <span style="color: #ae81ff">scheme</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">HTTP</span>
            <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">60</span>
            <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
            <span style="color: #ae81ff">successThreshold</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>
            <span style="color: #ae81ff">failureThreshold</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">5</span>
          <span style="color: #ae81ff">args</span><span style="color: #f8f8f2">:</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--cache-size=1000</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--no-resolv</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--server=127.0.0.1#10053</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--log-facility=-</span>
          <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">53</span>
            <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dns</span>
            <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">UDP</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">53</span>
            <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">dns-tcp</span>
            <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">TCP</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">healthz</span>
          <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">gcr.io/google_containers/exechealthz-amd64:1.2</span>
          <span style="color: #ae81ff">resources</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">limits</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">50Mi</span>
            <span style="color: #ae81ff">requests</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">cpu</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">10m</span>
              <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">50Mi</span>
          <span style="color: #ae81ff">args</span><span style="color: #f8f8f2">:</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #e6db74">&quot;--cmd=nslookup</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">kubernetes.default.svc.{{k8s_cluster_domain}}</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">127.0.0.1</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&gt;/dev/null&quot;</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--url=/healthz-dnsmasq</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #e6db74">&quot;--cmd=nslookup</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">kubernetes.default.svc.{{k8s_cluster_domain}}</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">127.0.0.1:10053</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&gt;/dev/null&quot;</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--url=/healthz-kubedns</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--port=8080</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">--quiet</span>
          <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">8080</span>
            <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">TCP</span>
        <span style="color: #ae81ff">dnsPolicy</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Default</span>

<span style="color: #ae81ff">k8s_dashboard_deployment</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Deployment</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">extensions/v1beta1</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">labels</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">replicas</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">1</span>
    <span style="color: #ae81ff">selector</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">matchLabels</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
    <span style="color: #ae81ff">template</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">labels</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
        <span style="color: #ae81ff">annotations</span><span style="color: #f8f8f2">:</span>
          <span style="color: #ae81ff">scheduler.alpha.kubernetes.io/tolerations</span><span style="color: #f8f8f2">:</span> <span style="color: #f8f8f2">|</span>
            <span style="color: #66d9ef">[</span>
              <span style="color: #66d9ef">{</span>
                <span style="color: #66d9ef">&quot;key&quot;: &quot;dedicated&quot;,</span>
                <span style="color: #66d9ef">&quot;operator&quot;: &quot;Equal&quot;,</span>
                <span style="color: #66d9ef">&quot;value&quot;: &quot;master&quot;,</span>
                <span style="color: #66d9ef">&quot;effect&quot;: &quot;NoSchedule&quot;</span>
              <span style="color: #66d9ef">}</span>
            <span style="color: #66d9ef">]</span>
      <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
        <span style="color: #ae81ff">containers</span><span style="color: #f8f8f2">:</span>
        <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
          <span style="color: #ae81ff">image</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;gcr.io/google_containers/kubernetes-dashboard-amd64:v{{k8s_dashboard_version}}&quot;</span>
          <span style="color: #ae81ff">imagePullPolicy</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Always</span>
          <span style="color: #ae81ff">resources</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">limits</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">cpu</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">100m</span>
              <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">50Mi</span>
            <span style="color: #ae81ff">requests</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">cpu</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">100m</span>
              <span style="color: #ae81ff">memory</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">50Mi</span>
          <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
          <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">containerPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">9090</span>
            <span style="color: #ae81ff">protocol</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">TCP</span>
          <span style="color: #ae81ff">args</span><span style="color: #f8f8f2">:</span>
            <span style="color: #75715e"># Uncomment the following line to manually specify Kubernetes API server Host</span>
            <span style="color: #75715e"># If not specified, Dashboard will attempt to auto discover the API server and connect</span>
            <span style="color: #75715e"># to it. Uncomment only if the default does not work.</span>
            <span style="color: #75715e"># - --apiserver-host=http://my-address:port</span>
          <span style="color: #ae81ff">livenessProbe</span><span style="color: #f8f8f2">:</span>
            <span style="color: #ae81ff">httpGet</span><span style="color: #f8f8f2">:</span>
              <span style="color: #ae81ff">path</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">/</span>
              <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">9090</span>
            <span style="color: #ae81ff">initialDelaySeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">30</span>
            <span style="color: #ae81ff">timeoutSeconds</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">30</span>

<span style="color: #ae81ff">k8s_dashboard_service</span><span style="color: #f8f8f2">:</span>
  <span style="color: #ae81ff">apiVersion</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">v1</span>
  <span style="color: #ae81ff">kind</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">Service</span>
  <span style="color: #ae81ff">metadata</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">name</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
    <span style="color: #ae81ff">namespace</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kube-system</span>
    <span style="color: #ae81ff">labels</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
      <span style="color: #ae81ff">kubernetes.io/cluster-service</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;true&quot;</span>
  <span style="color: #ae81ff">spec</span><span style="color: #f8f8f2">:</span>
    <span style="color: #ae81ff">selector</span><span style="color: #f8f8f2">:</span>
      <span style="color: #ae81ff">k8s-app</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">kubernetes-dashboard</span>
    <span style="color: #ae81ff">ports</span><span style="color: #f8f8f2">:</span>
    <span style="color: #f8f8f2">-</span> <span style="color: #ae81ff">port</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">80</span>
      <span style="color: #ae81ff">targetPort</span><span style="color: #f8f8f2">:</span> <span style="color: #ae81ff">9090</span>
</pre></div>
</p>

<p>If you need more information with a Vagrant test, you can take a look at the repository and <a href="https://galaxy.ansible.com/deimosfr/coreos-kubernetes/" target="_blank">Ansible galaxy</a>.</p>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://blog.deimos.fr/tags/ansible/">Ansible</a>

  <a class="tag tag--primary tag--small" href="https://blog.deimos.fr/tags/cloud/">Cloud</a>

  <a class="tag tag--primary tag--small" href="https://blog.deimos.fr/tags/kubernetes/">Kubernetes</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/08/20/kubernetes-with-traefik-and-lets-encrypt/" data-tooltip="Kubernetes with Traefik and Let&#39;s Encrypt">
              
                <i class="fa fa-angle-left"></i>
                <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
              </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/04/18/blog-migrated-to-hugo-on-github/" data-tooltip="Blog migrated to Hugo on Github">
              
                <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2017 Pierre Mavro / Deimosfr. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/08/20/kubernetes-with-traefik-and-lets-encrypt/" data-tooltip="Kubernetes with Traefik and Let&#39;s Encrypt">
              
                <i class="fa fa-angle-left"></i>
                <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
              </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/04/18/blog-migrated-to-hugo-on-github/" data-tooltip="Blog migrated to Hugo on Github">
              
                <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                <i class="fa fa-angle-right"></i>
              </a>
            </li>
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Pierre Mavro / Deimosfr</h4>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        SRE Lead DevOps at Criteo &nbsp;&bull;&nbsp; Nousmotards Co-Founder
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Paris - France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2017/08/20/kubernetes-with-traefik-and-lets-encrypt/">
                <h3 class="media-heading">Kubernetes with Traefik and Let&#39;s Encrypt</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Traefik (pronounced like traffic) is a modern HTTP reverse proxy and load balancer made to deploy microservices with ease. It supports several backends (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Eureka, Amazon DynamoDB, Rest API, file…) to manage its configuration automatically and dynamically.
I wanted to deploy it on Kubernetes for its interesting features like:
 Connect to Kubernetes API to listen changes and perform on the fly updates Automatic SSL management through Let&rsquo;s encrypt (SNI) Prometheus native integration HTTP/2 support  I really like HAProxy, but in a Kubernetes case, it&rsquo;s not the recommended solution because of its lake of features.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
                <h3 class="media-heading">Deploy Kubernetes with Ansible</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2017/04/18/blog-migrated-to-hugo-on-github/">
                <h3 class="media-heading">Blog migrated to Hugo on Github</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">As you certainly seen, the blog has been migrated :-). Visualy there is a big change and technically it&rsquo;s the same.
I was fed up about maintaining Wordpress with its stack (Nginx / php-fpm / MariaDB) for a mostly static blog. I was thinking about migrating from Wordpress to something in markdown since several years but didn&rsquo;t know exactly which solution I wanted to choose. I really enjoyed using Wordpress but wanted to keep hands on my blog and didn&rsquo;t want to switch to full hosted Wordpress because of its limitations (image size etc&hellip;).</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/09/30/deploy-coreos-with-ansible/">
                <h3 class="media-heading">Deploy CoreOS with Ansible</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">&nbsp;
CoreOS is a lightweight Linux operating system designed for clustered deployments providing automation, security, and scalability for your most critical applications.&nbsp;I&rsquo;ve been playing with CoreOS to replace Debian hosts which run Docker containers on Nousmotards project. CoreOS helps on simplifying bare metal deployment and avoid managing OS upgrade.
As I&rsquo;m still an Ansible lover, I&rsquo;ve made 2 roles:
 CoreOS Ansible:&nbsp;Ansible role to deploy pypy to CoreOS to be able to get Ansible prerequisites CoreOS: Ansible CoreOS role to deploy CoreOS on bare metal servers  If you want to quickly look at the result:</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/06/18/do-not-waste-time-with-grep-anymore-use-tag/">
                <h3 class="media-heading">Do not waste time with grep anymore, use tag</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Long time since my last post. This one is not very technical post, but it&rsquo;s a nice to have solution if you use grep usually. Are not you fed up to type vim  and search the line after a grep command ? If yes, this post is for you.
First of all, you may know that an alternative more user friendly to grep exist, called ag (perf comparison). I really like ag and grep, but something make me loose my time since several years and I&rsquo;m pretty sure it&rsquo;s your case too.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/01/21/zero-downtime-upgrade-with-ansible-and-haproxy/">
                <h3 class="media-heading">Zero downtime upgrade with Ansible and HAProxy</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Some of you may not be familiar with the terms &ldquo;Rolling upgrade&rdquo; or &ldquo;Rolling restart&rdquo;. This is the action of upgrading or restarting a cluster without service interruption (alias zero downtime). In most cases, this is done node by node, but in fact it depends of the technology you&rsquo;re managing and the number of active nodes in your cluster.
At Nousmotards we have several Java Spring Boot applications running. Restarting one application can take up to 1 min.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/01/20/how-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch/">
                <h3 class="media-heading">Elasticsearch: How we speed up news feeds and user walls display</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">&nbsp;
In my previous post, I talked about how to speed up reads and writes coupling Redis with Neo4J. Now I want to share with you how it&rsquo;s possible to unload your server and use Elasticsearch to speed up news feed and user wall.
1/ Show me your news feed A news feed is the main page of traditional social networks. Its main goal is to show you all recents updates from your friends and your interests.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/01/15/how-we-use-neo4j-on-our-social-network-and-workaround-performance-issues/">
                <h3 class="media-heading">How we use Neo4J on our social network and workaround performance issues</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Neo4J is the most popular graph database in the NoSQL databases family. We&rsquo;re using it in the Nousmotards project to store all social data through nodes and relationships.
Today I am going to talk about our experience after having using it for 2 years now (take a look at directed graph if you are not really familiar with Graph Database).
1/ Our use case Nousmotards is a social network for bikers, we aim to provide valuable tools to ride, meet and share nice time with people who like motorcycling.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/01/13/docker-why-you-should-use-monit-instead-of-supervisord/">
                <h3 class="media-heading">Docker: why you should use Monit instead of supervisord</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This title can sounds like a troll, but this is not the case! I&rsquo;m writing this post as a feedback. When I spoke during an Ansible meetup presenting Nousmotards infrastructure, I had several questions regarding why I chose monit as the init system instead of supervisord. That&rsquo;s what encouraged me to write this post and that&rsquo;s why I wanted to clarify here the things.
Introduction Docker is made to run a process in a confined area.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/01/08/graphite-events-on-debian-jessie/">
                <h3 class="media-heading">Graphite events on Debian jessie</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">I&rsquo;m using Graphite at work and for my Nousmotards project. For Nousmotards, I&rsquo;m using the Graphite version available in the default Debian Jessie repositories. This to avoid mismatch django dependencies etc&hellip;
A few days ago, I wanted to try Graphite events to get something pretty cool in Grafana :
This to be able to know when a new app version is deployed and make it easier to understand when an issue occurs.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         836 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://blog.deimos.fr/images/fish_background.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" integrity="sha256-IFHWFEbU2/+wNycDECKgjIRSirRNIDp2acEB5fvdVRU=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js" integrity="sha256-+mpyNVJsNt4rVXCw0F+pAOiB3YxmHgrbJsx4ecPuUaI=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js" integrity="sha256-vMxgR/7FtLovVA+IPrR7+xTgIgARH7y9VZQnmmi0HDI=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js" integrity="sha256-N0qFUh7/9vLvia87dDndewmsgsyYoNkdA212tPc+2NI=" crossorigin="anonymous"></script>


<script src="https://blog.deimos.fr/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/blog.deimos.fr\/2017\/04\/18\/deploy-kubernetes-with-ansible\/';
          
            this.page.identifier = '\/2017\/04\/18\/deploy-kubernetes-with-ansible\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'blog-deimosfr';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

