<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.30 with theme Tranquilpeak 0.4.3-SNAPSHOT">
<meta name="author" content="Pierre Mavro / Deimosfr">
<meta name="keywords" content="">
<meta name="description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">


<meta property="og:description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy Kubernetes with Ansible">
<meta name="twitter:title" content="Deploy Kubernetes with Ansible">
<meta property="og:url" content="https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
<meta property="twitter:url" content="https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
<meta property="og:site_name" content="Deimosfr Blog">
<meta property="og:description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">
<meta name="twitter:description" content="Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2017-04-18T20:18:07">
  
  
    <meta property="article:modified_time" content="2017-04-18T20:18:07">
  
  
  
    
      <meta property="article:section" content="Ansible">
    
      <meta property="article:section" content="Cloud">
    
      <meta property="article:section" content="Kubernetes">
    
  
  
    
      <meta property="article:tag" content="Ansible">
    
      <meta property="article:tag" content="Cloud">
    
      <meta property="article:tag" content="Kubernetes">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@deimosfr">


  <meta name="twitter:creator" content="@deimosfr">






  <meta property="og:image" content="https://blog.deimos.fr/thumbnails/logo_kubernetes.png">
  <meta property="twitter:image" content="https://blog.deimos.fr/thumbnails/logo_kubernetes.png">





  <meta property="og:image" content="https://www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=640">


    <title>Deploy Kubernetes with Ansible</title>

    <link rel="icon" href="https://blog.deimos.fr/favicon.png">
    

    

    <link rel="canonical" href="https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://blog.deimos.fr/css/style-nnm2spxvve8onlujjlegkkytaehyadd4ksxc1hyzzq9a2wvtrgbljqyulomn.min.css" />
    
    
      
        <link rel="stylesheet"  href="https://blog.deimos.fr/css/custom.css">
      
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63927289-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://blog.deimos.fr/">Deimosfr Blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://blog.deimos.fr/#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://blog.deimos.fr/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Pierre Mavro / Deimosfr</h4>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://blog.deimos.fr/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.deimos.fr" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-user"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://wiki.deimos.fr" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-wikipedia-w"></i>
      
      <span class="sidebar-button-desc">Wiki</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Deploy Kubernetes with Ansible
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2017-04-18T20:18:07&#43;02:00">
        
  
  
  
  
    18 April 2017
  

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://blog.deimos.fr/categories/ansible">Ansible</a>, 
    
      <a class="category-link" href="https://blog.deimos.fr/categories/cloud">Cloud</a>, 
    
      <a class="category-link" href="https://blog.deimos.fr/categories/kubernetes">Kubernetes</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p><img src="https://blog.deimos.fr/images/logo_kubernetes.png" alt="Kubernetes" /></p>

<p><a href="https://kubernetes.io/" target="_blank">Kubernetes</a> is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for <a href="https://www.nousmotards.com" target="_blank">Nousmotards</a> and decided to build an <a href="https://galaxy.ansible.com/deimosfr/coreos-kubernetes/" target="_blank">Ansible role</a> for it to make it simpler to deploy.</p>

<p>Why did I built it as other projects like <a href="https://github.com/kubernetes-incubator/kargo" target="_blank">Kargo</a> already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:</p>

<script type="text/javascript" src="https://asciinema.org/a/97170.js" id="asciicast-97170" async></script>

<p>This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages. The features are:</p>

<ul>
<li>Manage SSL certificats</li>
<li>Configuration changes made easy (all in config)</li>
<li>Lot of checks during playbook run</li>
<li>Manage Kubernetes upgrades</li>
<li>Deploy Kubernetes DNS and Dashboard</li>
</ul>

<p>If you want to know more on CoreOS installation with ansible, you can <a href="https://blog.deimos.fr/2016/09/30/deploy-coreos-with-ansible/" target="_blank">look at the previous post</a>.</p>

<p>If you look at the configuration, it could looks like big, but in fact it&rsquo;s not so complicated if you&rsquo;re a little bit familiar with Kubernetes:
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">k8s_version<span class="p">:</span><span class="w"> </span><span class="s1">&#39;v1.5.1_coreos.0&#39;</span><span class="w">
</span><span class="w"></span>k8s_dashboard_version<span class="p">:</span><span class="w"> </span><span class="s1">&#39;1.5.0&#39;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Master host will ideally be a network load balancer that sits in front of</span><span class="w">
</span><span class="w"></span><span class="c"># them. Alternatively, a DNS name can be configured which will resolve to</span><span class="w">
</span><span class="w"></span><span class="c"># the master IPs</span><span class="w">
</span><span class="w"></span>k8s_master_host<span class="p">:</span><span class="w"> </span><span class="s1">&#39;kub-master-host.myfqdn.com&#39;</span><span class="w">
</span><span class="w"></span>k8s_etcd_endpoints<span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://{{ groups[&#39;k8s-masters&#39;] | map(&#39;extract&#39;, hostvars, [&#39;priv_ip&#39;]) | join(&#39;:2379,http://&#39;) }}:2379&#34;</span><span class="w">
</span><span class="w"></span>k8s_flanneld_subnet<span class="p">:</span><span class="w"> </span><span class="s2">&#34;10.1.0.0/16&#34;</span><span class="w">
</span><span class="w"></span>k8s_pod_network<span class="p">:</span><span class="w"> </span><span class="s1">&#39;10.2.0.0/16&#39;</span><span class="w">
</span><span class="w"></span>k8s_service_ip_range<span class="p">:</span><span class="w"> </span><span class="s1">&#39;10.3.0.0/24&#39;</span><span class="w">
</span><span class="w"></span>k8s_service_ip<span class="p">:</span><span class="w"> </span><span class="s1">&#39;10.3.0.1&#39;</span><span class="w">
</span><span class="w"></span>k8s_dns_service_ip<span class="p">:</span><span class="w"> </span><span class="s1">&#39;10.3.0.10&#39;</span><span class="w">
</span><span class="w"></span>k8s_cluster_domain<span class="p">:</span><span class="w"> </span><span class="s1">&#39;cluster.local&#39;</span><span class="w">
</span><span class="w"></span>k8s_kubectl_cluster_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;default-cluster&#39;</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_adverstise_ip<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{ansible_enp0s8.ipv4.address}}&#34;</span><span class="w">
</span><span class="w"></span><span class="c"># Leave it blank if you&#39;re using flannel, otherwize use cni for Calico</span><span class="w">
</span><span class="w"></span>k8s_kublet_network_plugin<span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w">
</span><span class="w"></span><span class="c"># Set to false by default because kubelet-wrapper will handle it</span><span class="w">
</span><span class="w"></span>k8s_restart_kubelet<span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># SSL</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_role_path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;roles/deimosfr.coreos-kubernetes&#34;</span><span class="w">
</span><span class="w"></span>k8s_template_dir<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{k8s_role_path}}/templates&#34;</span><span class="w">
</span><span class="w"></span>k8s_ssl_local_path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{k8s_role_path}}/files/ssl/{{k8s_kubectl_cluster_name}}&#34;</span><span class="w">
</span><span class="w"></span>k8s_ssl_api_server_path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{k8s_ssl_local_path}}/api_servers&#34;</span><span class="w">
</span><span class="w"></span>k8s_ssl_workers_path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{k8s_ssl_local_path}}/workers&#34;</span><span class="w">
</span><span class="w"></span>k8s_ssl_admin_path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{k8s_ssl_local_path}}/admins&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_ssl_bytes_encrypt<span class="p">:</span><span class="w"> </span><span class="m">2048</span><span class="w">
</span><span class="w"></span>k8s_ssl_ca_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;ca-key.pem&#39;</span><span class="w">
</span><span class="w"></span>k8s_ssl_ca_pem_key_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;ca.pem&#39;</span><span class="w">
</span><span class="w"></span>k8s_ssl_valid_days<span class="p">:</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="w"></span>k8s_ssl_ca_pem_subj<span class="p">:</span><span class="w"> </span><span class="s1">&#39;/CN=kube-ca&#39;</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_ssl_apiserver_key_pem_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;apiserver-key.pem&#39;</span><span class="w">
</span><span class="w"></span>k8s_ssl_apiserver_csr_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;apiserver.csr&#39;</span><span class="w">
</span><span class="w"></span>k8s_ssl_apiserver_subj<span class="p">:</span><span class="w"> </span><span class="s1">&#39;/CN=kube-apiserver&#39;</span><span class="w">
</span><span class="w"></span>k8s_ssl_apiserver_pem_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;apiserver.pem&#39;</span><span class="w">
</span><span class="w"></span>k8s_ssl_apiserver_days<span class="p">:</span><span class="w"> </span><span class="m">10000</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_openssl_config<span class="p">:</span><span class="w">
</span><span class="w">  </span>req<span class="p">:</span><span class="w">
</span><span class="w">    </span>req_extensions<span class="p">:</span><span class="w"> </span><span class="s1">&#39;v3_req&#39;</span><span class="w">
</span><span class="w">    </span>distinguished_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;req_distinguished_name&#39;</span><span class="w">
</span><span class="w">  </span>req_distinguished_name<span class="p">:</span><span class="w">
</span><span class="w">  </span>v3_req<span class="p">:</span><span class="w">
</span><span class="w">    </span>basicConstraints<span class="p">:</span><span class="w"> </span><span class="s1">&#39;CA:FALSE&#39;</span><span class="w">
</span><span class="w">    </span>keyUsage<span class="p">:</span><span class="w"> </span><span class="s1">&#39;nonRepudiation, digitalSignature, keyEncipherment&#39;</span><span class="w">
</span><span class="w">    </span>subjectAltName<span class="p">:</span><span class="w"> </span><span class="s1">&#39;@alt_names&#39;</span><span class="w">
</span><span class="w">  </span>alt_names<span class="p">:</span><span class="w">
</span><span class="w">    </span>DNS<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>kubernetes<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>kubernetes.default<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>kubernetes.default.svc<span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;kubernetes.default.svc.{{k8s_cluster_domain}}&#34;</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;*.myfqdn.com&#34;</span><span class="w">
</span><span class="w">    </span><span class="c"># Do not fulfil IP of master nodes, they&#39;ll be automatically generated</span><span class="w">
</span><span class="w">    </span><span class="c"># from k8s-masters group</span><span class="w">
</span><span class="w">    </span>IP<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span><span class="s2">&#34;{{k8s_service_ip}}&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_workers_openssl_config<span class="p">:</span><span class="w">
</span><span class="w">  </span>req<span class="p">:</span><span class="w">
</span><span class="w">    </span>req_extensions<span class="p">:</span><span class="w"> </span><span class="s1">&#39;v3_req&#39;</span><span class="w">
</span><span class="w">    </span>distinguished_name<span class="p">:</span><span class="w"> </span><span class="s1">&#39;req_distinguished_name&#39;</span><span class="w">
</span><span class="w">  </span>req_distinguished_name<span class="p">:</span><span class="w">
</span><span class="w">  </span>v3_req<span class="p">:</span><span class="w">
</span><span class="w">    </span>basicConstraints<span class="p">:</span><span class="w"> </span><span class="s1">&#39;CA:FALSE&#39;</span><span class="w">
</span><span class="w">    </span>keyUsage<span class="p">:</span><span class="w"> </span><span class="s1">&#39;nonRepudiation, digitalSignature, keyEncipherment&#39;</span><span class="w">
</span><span class="w">    </span>subjectAltName<span class="p">:</span><span class="w"> </span><span class="s1">&#39;@alt_names&#39;</span><span class="w">
</span><span class="w">  </span><span class="c"># Do not fulfil alt_names, it will automatically be generated</span><span class="w">
</span><span class="w">  </span>alt_names<span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_kube_apiserver<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Pod<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-apiserver<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>hostNetwork<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>containers<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kube-apiserver<span class="w">
</span><span class="w">      </span>image<span class="p">:</span><span class="w"> </span><span class="s2">&#34;quay.io/coreos/hyperkube:{{k8s_version}}&#34;</span><span class="w">
</span><span class="w">      </span>command<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>/hyperkube<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>apiserver<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--bind-address=<span class="m">0.0</span>.<span class="m">0.0</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--etcd-servers={{k8s_etcd_endpoints}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--allow-privileged=<span class="kc">true</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--service-cluster-ip-range={{k8s_service_ip_range}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--secure-port=<span class="m">443</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--advertise-address={{k8s_adverstise_ip}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--admission-control=NamespaceLifecycle<span class="p">,</span>LimitRanger<span class="p">,</span>ServiceAccount<span class="p">,</span>DefaultStorageClass<span class="p">,</span>ResourceQuota<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--tls-cert-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_pem_name}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--tls-private-key-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_key_pem_name}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--client-ca-file=/etc/kubernetes/ssl/{{k8s_ssl_ca_pem_key_name}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--service-account-key-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_key_pem_name}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--runtime-config=extensions/v1beta<span class="m">1</span>=<span class="kc">true</span><span class="p">,</span>extensions/v1beta<span class="m">1</span>/networkpolicies=<span class="kc">true</span><span class="w">
</span><span class="w">      </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">        </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">          </span>host<span class="p">:</span><span class="w"> </span><span class="m">127.0</span>.<span class="m">0.1</span><span class="w">
</span><span class="w">          </span>port<span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">          </span>path<span class="p">:</span><span class="w"> </span>/healthz<span class="w">
</span><span class="w">        </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">15</span><span class="w">
</span><span class="w">        </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">15</span><span class="w">
</span><span class="w">      </span>ports<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span><span class="w">        </span>hostPort<span class="p">:</span><span class="w"> </span><span class="m">443</span><span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>https<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">        </span>hostPort<span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>local<span class="w">
</span><span class="w">      </span>volumeMounts<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl<span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-kubernetes<span class="w">
</span><span class="w">        </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/ssl/certs<span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-host<span class="w">
</span><span class="w">        </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>volumes<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">        </span>path<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl<span class="w">
</span><span class="w">      </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-kubernetes<span class="w">
</span><span class="w">    </span>-<span class="w"> </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">        </span>path<span class="p">:</span><span class="w"> </span>/usr/share/ca-certificates<span class="w">
</span><span class="w">      </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-host<span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_kube_proxy_masters<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Pod<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-proxy<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>hostNetwork<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>containers<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kube-proxy<span class="w">
</span><span class="w">      </span>image<span class="p">:</span><span class="w"> </span><span class="s2">&#34;quay.io/coreos/hyperkube:{{k8s_version}}&#34;</span><span class="w">
</span><span class="w">      </span>command<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>/hyperkube<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>proxy<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--master=http<span class="p">:</span>//<span class="m">127.0</span>.<span class="m">0.1</span><span class="p">:</span><span class="m">8080</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--proxy-mode=iptables<span class="w">
</span><span class="w">      </span>securityContext<span class="p">:</span><span class="w">
</span><span class="w">        </span>privileged<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span>volumeMounts<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/ssl/certs<span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-host<span class="w">
</span><span class="w">        </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>volumes<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">        </span>path<span class="p">:</span><span class="w"> </span>/usr/share/ca-certificates<span class="w">
</span><span class="w">      </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-host<span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_kube_proxy_workers<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Pod<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-proxy<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>hostNetwork<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>containers<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kube-proxy<span class="w">
</span><span class="w">      </span>image<span class="p">:</span><span class="w"> </span><span class="s2">&#34;quay.io/coreos/hyperkube:{{k8s_version}}&#34;</span><span class="w">
</span><span class="w">      </span>command<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>/hyperkube<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>proxy<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--master=https<span class="p">:</span>//{{k8s_master_host}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--kubeconfig=/etc/kubernetes/worker-kubeconfig.yaml<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--proxy-mode=iptables<span class="w">
</span><span class="w">      </span>securityContext<span class="p">:</span><span class="w">
</span><span class="w">        </span>privileged<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span>volumeMounts<span class="p">:</span><span class="w">
</span><span class="w">        </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/ssl/certs<span class="w">
</span><span class="w">          </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;ssl-certs&#34;</span><span class="w">
</span><span class="w">        </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/kubernetes/worker-kubeconfig.yaml<span class="w">
</span><span class="w">          </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubeconfig&#34;</span><span class="w">
</span><span class="w">          </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl<span class="w">
</span><span class="w">          </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;etc-kube-ssl&#34;</span><span class="w">
</span><span class="w">          </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>volumes<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;ssl-certs&#34;</span><span class="w">
</span><span class="w">        </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">          </span>path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;/usr/share/ca-certificates&#34;</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;kubeconfig&#34;</span><span class="w">
</span><span class="w">        </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">          </span>path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/kubernetes/worker-kubeconfig.yaml&#34;</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;etc-kube-ssl&#34;</span><span class="w">
</span><span class="w">        </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">          </span>path<span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/kubernetes/ssl&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_kube_controller_manager<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Pod<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-controller-manager<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>hostNetwork<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>containers<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kube-controller-manager<span class="w">
</span><span class="w">      </span>image<span class="p">:</span><span class="w"> </span><span class="s2">&#34;quay.io/coreos/hyperkube:{{k8s_version}}&#34;</span><span class="w">
</span><span class="w">      </span>command<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>/hyperkube<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>controller-manager<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--master=http<span class="p">:</span>//<span class="m">127.0</span>.<span class="m">0.1</span><span class="p">:</span><span class="m">8080</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--leader-elect=<span class="kc">true</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--service-account-private-key-file=/etc/kubernetes/ssl/{{k8s_ssl_apiserver_key_pem_name}}<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--root-ca-file=/etc/kubernetes/ssl/{{k8s_ssl_ca_pem_key_name}}<span class="w">
</span><span class="w">      </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">        </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">          </span>host<span class="p">:</span><span class="w"> </span><span class="m">127.0</span>.<span class="m">0.1</span><span class="w">
</span><span class="w">          </span>path<span class="p">:</span><span class="w"> </span>/healthz<span class="w">
</span><span class="w">          </span>port<span class="p">:</span><span class="w"> </span><span class="m">10252</span><span class="w">
</span><span class="w">        </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">15</span><span class="w">
</span><span class="w">        </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span>volumeMounts<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl<span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-kubernetes<span class="w">
</span><span class="w">        </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>mountPath<span class="p">:</span><span class="w"> </span>/etc/ssl/certs<span class="w">
</span><span class="w">        </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-host<span class="w">
</span><span class="w">        </span>readOnly<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>volumes<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">        </span>path<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl<span class="w">
</span><span class="w">      </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-kubernetes<span class="w">
</span><span class="w">    </span>-<span class="w"> </span>hostPath<span class="p">:</span><span class="w">
</span><span class="w">        </span>path<span class="p">:</span><span class="w"> </span>/usr/share/ca-certificates<span class="w">
</span><span class="w">      </span>name<span class="p">:</span><span class="w"> </span>ssl-certs-host<span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_kube_scheduler<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Pod<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-scheduler<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>hostNetwork<span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span>containers<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kube-scheduler<span class="w">
</span><span class="w">      </span>image<span class="p">:</span><span class="w"> </span><span class="s2">&#34;quay.io/coreos/hyperkube:{{k8s_version}}&#34;</span><span class="w">
</span><span class="w">      </span>command<span class="p">:</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>/hyperkube<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>scheduler<span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--master=http<span class="p">:</span>//<span class="m">127.0</span>.<span class="m">0.1</span><span class="p">:</span><span class="m">8080</span><span class="w">
</span><span class="w">      </span>-<span class="w"> </span>--leader-elect=<span class="kc">true</span><span class="w">
</span><span class="w">      </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">        </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">          </span>host<span class="p">:</span><span class="w"> </span><span class="m">127.0</span>.<span class="m">0.1</span><span class="w">
</span><span class="w">          </span>path<span class="p">:</span><span class="w"> </span>/healthz<span class="w">
</span><span class="w">          </span>port<span class="p">:</span><span class="w"> </span><span class="m">10251</span><span class="w">
</span><span class="w">        </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">15</span><span class="w">
</span><span class="w">        </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_worker_kubeconfig<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Config<span class="w">
</span><span class="w">  </span>clusters<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>local<span class="w">
</span><span class="w">    </span>cluster<span class="p">:</span><span class="w">
</span><span class="w">      </span>certificate-authority<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl/ca.pem<span class="w">
</span><span class="w">      </span>server<span class="p">:</span><span class="w"> </span><span class="s2">&#34;https://{{k8s_master_host}}:443&#34;</span><span class="w">
</span><span class="w">  </span>users<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kubelet<span class="w">
</span><span class="w">    </span>user<span class="p">:</span><span class="w">
</span><span class="w">      </span>client-certificate<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl/worker.pem<span class="w">
</span><span class="w">      </span>client-key<span class="p">:</span><span class="w"> </span>/etc/kubernetes/ssl/worker-key.pem<span class="w">
</span><span class="w">  </span>contexts<span class="p">:</span><span class="w">
</span><span class="w">  </span>-<span class="w"> </span>context<span class="p">:</span><span class="w">
</span><span class="w">      </span>cluster<span class="p">:</span><span class="w"> </span>local<span class="w">
</span><span class="w">      </span>user<span class="p">:</span><span class="w"> </span>kubelet<span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kubelet-context<span class="w">
</span><span class="w">  </span>current-context<span class="p">:</span><span class="w"> </span>kubelet-context<span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># 3rd party apps</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_dns_service<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Service<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-dns<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">    </span>labels<span class="p">:</span><span class="w">
</span><span class="w">      </span>k8s-app<span class="p">:</span><span class="w"> </span>kube-dns<span class="w">
</span><span class="w">      </span>kubernetes.io/cluster-service<span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">      </span>kubernetes.io/name<span class="p">:</span><span class="w"> </span><span class="s2">&#34;KubeDNS&#34;</span><span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>selector<span class="p">:</span><span class="w">
</span><span class="w">      </span>k8s-app<span class="p">:</span><span class="w"> </span>kube-dns<span class="w">
</span><span class="w">    </span>clusterIP<span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{k8s_dns_service_ip}}&#34;</span><span class="w">
</span><span class="w">    </span>ports<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>dns<span class="w">
</span><span class="w">      </span>port<span class="p">:</span><span class="w"> </span><span class="m">53</span><span class="w">
</span><span class="w">      </span>protocol<span class="p">:</span><span class="w"> </span>UDP<span class="w">
</span><span class="w">    </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>dns-tcp<span class="w">
</span><span class="w">      </span>port<span class="p">:</span><span class="w"> </span><span class="m">53</span><span class="w">
</span><span class="w">      </span>protocol<span class="p">:</span><span class="w"> </span>TCP<span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_dns_replication_controller<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>ReplicationController<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kube-dns-v<span class="m">20</span><span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">    </span>labels<span class="p">:</span><span class="w">
</span><span class="w">      </span>k8s-app<span class="p">:</span><span class="w"> </span>kube-dns<span class="w">
</span><span class="w">      </span>version<span class="p">:</span><span class="w"> </span>v<span class="m">20</span><span class="w">
</span><span class="w">      </span>kubernetes.io/cluster-service<span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>replicas<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span>selector<span class="p">:</span><span class="w">
</span><span class="w">      </span>k8s-app<span class="p">:</span><span class="w"> </span>kube-dns<span class="w">
</span><span class="w">      </span>version<span class="p">:</span><span class="w"> </span>v<span class="m">20</span><span class="w">
</span><span class="w">    </span>template<span class="p">:</span><span class="w">
</span><span class="w">      </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">        </span>labels<span class="p">:</span><span class="w">
</span><span class="w">          </span>k8s-app<span class="p">:</span><span class="w"> </span>kube-dns<span class="w">
</span><span class="w">          </span>version<span class="p">:</span><span class="w"> </span>v<span class="m">20</span><span class="w">
</span><span class="w">        </span>annotations<span class="p">:</span><span class="w">
</span><span class="w">          </span>scheduler.alpha.kubernetes.io/critical-pod<span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w">
</span><span class="w">          </span>scheduler.alpha.kubernetes.io/tolerations<span class="p">:</span><span class="w"> </span><span class="s1">&#39;[{&#34;key&#34;:&#34;CriticalAddonsOnly&#34;, &#34;operator&#34;:&#34;Exists&#34;}]&#39;</span><span class="w">
</span><span class="w">      </span>spec<span class="p">:</span><span class="w">
</span><span class="w">        </span>containers<span class="p">:</span><span class="w">
</span><span class="w">        </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kubedns<span class="w">
</span><span class="w">          </span>image<span class="p">:</span><span class="w"> </span>gcr.io/google_containers/kubedns-amd<span class="m">64</span><span class="p">:</span><span class="m">1.9</span><span class="w">
</span><span class="w">          </span>resources<span class="p">:</span><span class="w">
</span><span class="w">            </span>limits<span class="p">:</span><span class="w">
</span><span class="w">              </span>memory<span class="p">:</span><span class="w"> </span>170Mi<span class="w">
</span><span class="w">            </span>requests<span class="p">:</span><span class="w">
</span><span class="w">              </span>cpu<span class="p">:</span><span class="w"> </span>100m<span class="w">
</span><span class="w">              </span>memory<span class="p">:</span><span class="w"> </span>70Mi<span class="w">
</span><span class="w">          </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">            </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">              </span>path<span class="p">:</span><span class="w"> </span>/healthz-kubedns<span class="w">
</span><span class="w">              </span>port<span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">              </span>scheme<span class="p">:</span><span class="w"> </span>HTTP<span class="w">
</span><span class="w">            </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span><span class="w">            </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="w">            </span>successThreshold<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">            </span>failureThreshold<span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="w">          </span>readinessProbe<span class="p">:</span><span class="w">
</span><span class="w">            </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">              </span>path<span class="p">:</span><span class="w"> </span>/readiness<span class="w">
</span><span class="w">              </span>port<span class="p">:</span><span class="w"> </span><span class="m">8081</span><span class="w">
</span><span class="w">              </span>scheme<span class="p">:</span><span class="w"> </span>HTTP<span class="w">
</span><span class="w">            </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="w">            </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="w">          </span>args<span class="p">:</span><span class="w">
</span><span class="w">            </span>-<span class="w"> </span><span class="s2">&#34;--domain={{k8s_cluster_domain}}.&#34;</span><span class="w">
</span><span class="w">            </span>-<span class="w"> </span>--dns-port=<span class="m">10053</span><span class="w">
</span><span class="w">          </span>ports<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">10053</span><span class="w">
</span><span class="w">            </span>name<span class="p">:</span><span class="w"> </span>dns-local<span class="w">
</span><span class="w">            </span>protocol<span class="p">:</span><span class="w"> </span>UDP<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">10053</span><span class="w">
</span><span class="w">            </span>name<span class="p">:</span><span class="w"> </span>dns-tcp-local<span class="w">
</span><span class="w">            </span>protocol<span class="p">:</span><span class="w"> </span>TCP<span class="w">
</span><span class="w">        </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>dnsmasq<span class="w">
</span><span class="w">          </span>image<span class="p">:</span><span class="w"> </span>gcr.io/google_containers/kube-dnsmasq-amd<span class="m">64</span><span class="p">:</span><span class="m">1.4</span><span class="w">
</span><span class="w">          </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">            </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">              </span>path<span class="p">:</span><span class="w"> </span>/healthz-dnsmasq<span class="w">
</span><span class="w">              </span>port<span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">              </span>scheme<span class="p">:</span><span class="w"> </span>HTTP<span class="w">
</span><span class="w">            </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span><span class="w">            </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="w">            </span>successThreshold<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">            </span>failureThreshold<span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span><span class="w">          </span>args<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--cache-size=<span class="m">1000</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--no-resolv<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--server=<span class="m">127.0</span>.<span class="m">0.1</span><span class="c">#10053</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--log-facility=-<span class="w">
</span><span class="w">          </span>ports<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">53</span><span class="w">
</span><span class="w">            </span>name<span class="p">:</span><span class="w"> </span>dns<span class="w">
</span><span class="w">            </span>protocol<span class="p">:</span><span class="w"> </span>UDP<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">53</span><span class="w">
</span><span class="w">            </span>name<span class="p">:</span><span class="w"> </span>dns-tcp<span class="w">
</span><span class="w">            </span>protocol<span class="p">:</span><span class="w"> </span>TCP<span class="w">
</span><span class="w">        </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>healthz<span class="w">
</span><span class="w">          </span>image<span class="p">:</span><span class="w"> </span>gcr.io/google_containers/exechealthz-amd<span class="m">64</span><span class="p">:</span><span class="m">1.2</span><span class="w">
</span><span class="w">          </span>resources<span class="p">:</span><span class="w">
</span><span class="w">            </span>limits<span class="p">:</span><span class="w">
</span><span class="w">              </span>memory<span class="p">:</span><span class="w"> </span>50Mi<span class="w">
</span><span class="w">            </span>requests<span class="p">:</span><span class="w">
</span><span class="w">              </span>cpu<span class="p">:</span><span class="w"> </span>10m<span class="w">
</span><span class="w">              </span>memory<span class="p">:</span><span class="w"> </span>50Mi<span class="w">
</span><span class="w">          </span>args<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span><span class="s2">&#34;--cmd=nslookup kubernetes.default.svc.{{k8s_cluster_domain}} 127.0.0.1 &gt;/dev/null&#34;</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--url=/healthz-dnsmasq<span class="w">
</span><span class="w">          </span>-<span class="w"> </span><span class="s2">&#34;--cmd=nslookup kubernetes.default.svc.{{k8s_cluster_domain}} 127.0.0.1:10053 &gt;/dev/null&#34;</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--url=/healthz-kubedns<span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--port=<span class="m">8080</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>--quiet<span class="w">
</span><span class="w">          </span>ports<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span><span class="w">            </span>protocol<span class="p">:</span><span class="w"> </span>TCP<span class="w">
</span><span class="w">        </span>dnsPolicy<span class="p">:</span><span class="w"> </span>Default<span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_dashboard_deployment<span class="p">:</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Deployment<span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>extensions/v1beta<span class="m">1</span><span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>labels<span class="p">:</span><span class="w">
</span><span class="w">      </span>app<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>replicas<span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">    </span>selector<span class="p">:</span><span class="w">
</span><span class="w">      </span>matchLabels<span class="p">:</span><span class="w">
</span><span class="w">        </span>app<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">    </span>template<span class="p">:</span><span class="w">
</span><span class="w">      </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">        </span>labels<span class="p">:</span><span class="w">
</span><span class="w">          </span>app<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">        </span>annotations<span class="p">:</span><span class="w">
</span><span class="w">          </span>scheduler.alpha.kubernetes.io/tolerations<span class="p">:</span><span class="w"> </span><span class="sd">|
</span><span class="sd">            [
</span><span class="sd">              {
</span><span class="sd">                &#34;key&#34;: &#34;dedicated&#34;,
</span><span class="sd">                &#34;operator&#34;: &#34;Equal&#34;,
</span><span class="sd">                &#34;value&#34;: &#34;master&#34;,
</span><span class="sd">                &#34;effect&#34;: &#34;NoSchedule&#34;
</span><span class="sd">              }
</span><span class="sd">            ]</span><span class="w">
</span><span class="w">      </span>spec<span class="p">:</span><span class="w">
</span><span class="w">        </span>containers<span class="p">:</span><span class="w">
</span><span class="w">        </span>-<span class="w"> </span>name<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">          </span>image<span class="p">:</span><span class="w"> </span><span class="s2">&#34;gcr.io/google_containers/kubernetes-dashboard-amd64:v{{k8s_dashboard_version}}&#34;</span><span class="w">
</span><span class="w">          </span>imagePullPolicy<span class="p">:</span><span class="w"> </span>Always<span class="w">
</span><span class="w">          </span>resources<span class="p">:</span><span class="w">
</span><span class="w">            </span>limits<span class="p">:</span><span class="w">
</span><span class="w">              </span>cpu<span class="p">:</span><span class="w"> </span>100m<span class="w">
</span><span class="w">              </span>memory<span class="p">:</span><span class="w"> </span>50Mi<span class="w">
</span><span class="w">            </span>requests<span class="p">:</span><span class="w">
</span><span class="w">              </span>cpu<span class="p">:</span><span class="w"> </span>100m<span class="w">
</span><span class="w">              </span>memory<span class="p">:</span><span class="w"> </span>50Mi<span class="w">
</span><span class="w">          </span>ports<span class="p">:</span><span class="w">
</span><span class="w">          </span>-<span class="w"> </span>containerPort<span class="p">:</span><span class="w"> </span><span class="m">9090</span><span class="w">
</span><span class="w">            </span>protocol<span class="p">:</span><span class="w"> </span>TCP<span class="w">
</span><span class="w">          </span>args<span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="c"># Uncomment the following line to manually specify Kubernetes API server Host</span><span class="w">
</span><span class="w">            </span><span class="c"># If not specified, Dashboard will attempt to auto discover the API server and connect</span><span class="w">
</span><span class="w">            </span><span class="c"># to it. Uncomment only if the default does not work.</span><span class="w">
</span><span class="w">            </span><span class="c"># - --apiserver-host=http://my-address:port</span><span class="w">
</span><span class="w">          </span>livenessProbe<span class="p">:</span><span class="w">
</span><span class="w">            </span>httpGet<span class="p">:</span><span class="w">
</span><span class="w">              </span>path<span class="p">:</span><span class="w"> </span>/<span class="w">
</span><span class="w">              </span>port<span class="p">:</span><span class="w"> </span><span class="m">9090</span><span class="w">
</span><span class="w">            </span>initialDelaySeconds<span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="w">            </span>timeoutSeconds<span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span><span class="w">
</span><span class="w"></span>k8s_dashboard_service<span class="p">:</span><span class="w">
</span><span class="w">  </span>apiVersion<span class="p">:</span><span class="w"> </span>v<span class="m">1</span><span class="w">
</span><span class="w">  </span>kind<span class="p">:</span><span class="w"> </span>Service<span class="w">
</span><span class="w">  </span>metadata<span class="p">:</span><span class="w">
</span><span class="w">    </span>name<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">    </span>namespace<span class="p">:</span><span class="w"> </span>kube-system<span class="w">
</span><span class="w">    </span>labels<span class="p">:</span><span class="w">
</span><span class="w">      </span>k8s-app<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">      </span>kubernetes.io/cluster-service<span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span><span class="w">  </span>spec<span class="p">:</span><span class="w">
</span><span class="w">    </span>selector<span class="p">:</span><span class="w">
</span><span class="w">      </span>k8s-app<span class="p">:</span><span class="w"> </span>kubernetes-dashboard<span class="w">
</span><span class="w">    </span>ports<span class="p">:</span><span class="w">
</span><span class="w">    </span>-<span class="w"> </span>port<span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span><span class="w">      </span>targetPort<span class="p">:</span><span class="w"> </span><span class="m">9090</span></code></pre></div></p>

<p>If you need more information with a Vagrant test, you can take a look at the repository and <a href="https://galaxy.ansible.com/deimosfr/coreos-kubernetes/" target="_blank">Ansible galaxy</a>.</p>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://blog.deimos.fr/tags/ansible/">Ansible</a>

  <a class="tag tag--primary tag--small" href="https://blog.deimos.fr/tags/cloud/">Cloud</a>

  <a class="tag tag--primary tag--small" href="https://blog.deimos.fr/tags/kubernetes/">Kubernetes</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/08/20/kubernetes-with-traefik-and-lets-encrypt/" data-tooltip="Kubernetes with Traefik and Let&#39;s Encrypt">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/04/18/blog-migrated-to-hugo-on-github/" data-tooltip="Blog migrated to Hugo on Github">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Pierre Mavro / Deimosfr. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/08/20/kubernetes-with-traefik-and-lets-encrypt/" data-tooltip="Kubernetes with Traefik and Let&#39;s Encrypt">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://blog.deimos.fr/2017/04/18/blog-migrated-to-hugo-on-github/" data-tooltip="Blog migrated to Hugo on Github">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.deimos.fr%2F2017%2F04%2F18%2Fdeploy-kubernetes-with-ansible%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fblog.deimos.fr%2F2017%2F04%2F18%2Fdeploy-kubernetes-with-ansible%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2Fblog.deimos.fr%2F2017%2F04%2F18%2Fdeploy-kubernetes-with-ansible%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Pierre Mavro / Deimosfr</h4>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        MySocialApp Co-Founder &nbsp;&bull;&nbsp; Staff SRE Lead at Criteo
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Paris - France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2018/10/11/converting-raw-to-jpg-with-nice-rendering/">
                <h3 class="media-heading">Converting RAW to JPG with nice rendering</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Oct 10, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">I&rsquo;m an amateur photographer and I&rsquo;m using an Olympus E-M1 Mark II camera. I take photos in RAW mode to be able. For those who know me, my computer is running on Linux and I&rsquo;m using Geeqie to display RAW picture. It&rsquo;s a very fast and powerful solution to display them.
In addition of displaying them quickly, it enhances the look and I really appreciate the rendering. Here is the original image (the first one) and the redered one by Geeqie (the second one):</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2018/06/24/running-cassandra-on-kubernetes/">
                <h3 class="media-heading">Running Cassandra in Kubernetes</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jul 7, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">For my own company MySocialApp, I&rsquo;m managing multiple Cassandra clusters on top of a Kubernetes on premise cluster. For those who never heard of this distributed database, here is the summary from the official website:
 The Apache Cassandra database is the right choice when you need scalability and high availability without compromising performance. Linear scalability and proven fault-tolerance on commodity hardware or cloud infrastructure make it the perfect platform for mission-critical data.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2018/01/31/integrate-gcr-in-your-on-premise-kubernetes/">
                <h3 class="media-heading">Integrate GCR in your on premise k8s cluster</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">I&rsquo;m using Kubernetes on an on premise cluster for MySocialApp. Today, I&rsquo;m storing MySocialApp public images at Quay.io and I also wanted to store private images. I didn&rsquo;t want to bootstrap a private registry for it to avoid maintaining it, having a distributed storage to maintain for it etc&hellip;but wanted a solution at a lower cost.
I started to look at DockerHub and Quay.io. As far aas I saw, DockerHub do not provide private registry while Quay does.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2018/01/26/install-jeedom-on-synology-with-docker/">
                <h3 class="media-heading">Install Jeedom on Synology with Docker</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">The Jeedom software is open source; you have complete access to the software that manages your home automation. Jeedom is compatible with various protocols, like Z-Wave, RFXCOM, RTS SOMFY, EnOcean, xPL, etc.
Installing Jeedom on Synology with Docker it not a complex task. However for those who are not familiar with those technologies, I summarized here the installation process for a Z-wave network.
First of all, let&rsquo;s look at the requirements:</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2018/01/23/traefik-ha-helm-chart-with-le-on-k8s/">
                <h3 class="media-heading">Traefik HA Helm chart with Let&#39;s Encrypt on Kubernetes</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Traefik (pronounced like traffic) is a modern HTTP reverse proxy and load balancer made to deploy microservices with ease. It supports several backends (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Eureka, Amazon DynamoDB, Rest API, file…) to manage its configuration automatically and dynamically.
In a previous post, I explained how to manually deploy it in HA mode. For MySocialApp (iOS and Android social app builder - SaaS), I had to automate it.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2018/01/18/mysocialapp-crate-your-own-social-network/">
                <h3 class="media-heading">MySocialApp Create your own social network</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">If you follow me, you may know that I launched with friends Nousmotards social application a few years ago. The solution continue to grow in France with more than 70k bikers and that&rsquo;s a good point for all those riders :)
Since we launched Nousmotards, several persons asked us: &ldquo;You&rsquo;ve made an amazing job for bikers, do you provide your social solution to any other communities or for enterprises?&rdquo;. The answer was: No we didn&rsquo;t.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2017/08/20/kubernetes-with-traefik-and-lets-encrypt/">
                <h3 class="media-heading">Kubernetes with Traefik and Let&#39;s Encrypt</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Aug 8, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Traefik (pronounced like traffic) is a modern HTTP reverse proxy and load balancer made to deploy microservices with ease. It supports several backends (Docker, Swarm, Kubernetes, Marathon, Mesos, Consul, Etcd, Zookeeper, BoltDB, Eureka, Amazon DynamoDB, Rest API, file…) to manage its configuration automatically and dynamically.
I wanted to deploy it on Kubernetes for its interesting features like:
 Connect to Kubernetes API to listen changes and perform on the fly updates Automatic SSL management through Let&rsquo;s encrypt (SNI) Prometheus native integration HTTP/2 support  I really like HAProxy, but in a Kubernetes case, it&rsquo;s not the recommended solution because of its lake of features.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2017/04/18/deploy-kubernetes-with-ansible/">
                <h3 class="media-heading">Deploy Kubernetes with Ansible</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Kubernetes is an open-source system for automating deployment, scaling, and management of containerized applications. I&rsquo;m using it for Nousmotards and decided to build an Ansible role for it to make it simpler to deploy.
Why did I built it as other projects like Kargo already exists? I just wanted a simple and maintainable role based on CoreOS official documentation. That&rsquo;s what I did:
 This role bootstrap a Kubernetes cluster based on CoreOS Container Linux for production usages.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2017/04/18/blog-migrated-to-hugo-on-github/">
                <h3 class="media-heading">Blog migrated to Hugo on Github</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">As you certainly seen, the blog has been migrated :-). Visualy there is a big change and technically it&rsquo;s the same.
I was fed up about maintaining Wordpress with its stack (Nginx / php-fpm / MariaDB) for a mostly static blog. I was thinking about migrating from Wordpress to something in markdown since several years but didn&rsquo;t know exactly which solution I wanted to choose. I really enjoyed using Wordpress but wanted to keep hands on my blog and didn&rsquo;t want to switch to full hosted Wordpress because of its limitations (image size etc&hellip;).</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://blog.deimos.fr/2016/09/30/deploy-coreos-with-ansible/">
                <h3 class="media-heading">Deploy CoreOS with Ansible</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">&nbsp;
CoreOS is a lightweight Linux operating system designed for clustered deployments providing automation, security, and scalability for your most critical applications.&nbsp;I&rsquo;ve been playing with CoreOS to replace Debian hosts which run Docker containers on Nousmotards project. CoreOS helps on simplifying bare metal deployment and avoid managing OS upgrade.
As I&rsquo;m still an Ansible lover, I&rsquo;ve made 2 roles:
 CoreOS Ansible:&nbsp;Ansible role to deploy pypy to CoreOS to be able to get Ansible prerequisites CoreOS: Ansible CoreOS role to deploy CoreOS on bare metal servers  If you want to quickly look at the result:</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         841 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://blog.deimos.fr/images/fish_background.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="https://blog.deimos.fr/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


  
    <script src="https://blog.deimos.fr/js/custom.js"></script>
  

<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/blog.deimos.fr\/2017\/04\/18\/deploy-kubernetes-with-ansible\/';
          
            this.page.identifier = '\/2017\/04\/18\/deploy-kubernetes-with-ansible\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'blog-deimosfr';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

