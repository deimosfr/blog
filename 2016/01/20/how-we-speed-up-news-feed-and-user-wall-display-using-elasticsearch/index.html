

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.20.1">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>Elasticsearch: How we speed up news feeds and user walls display</title>
    <meta name="author" content="Pierre Mavro / Deimosfr">
    <meta name="keywords" content="">

    <link rel="icon" href="https://deimosfr.github.io/blog/favicon.png">
    

    
    <meta name="description" content="&nbsp;
In my previous post, I talked about how to speed up reads and writes couplingÂ RedisÂ withÂ Neo4J. Now I want to share with you how it&rsquo;s possible to unload your server and use Elasticsearch to speed up news feed and user wall.
1/ Show me your news feed A news feed is the main page of traditional social networks. ItsÂ main goal is to showÂ you all recents updates from your friends and your interests.">
    <meta property="og:description" content="&nbsp;
In my previous post, I talked about how to speed up reads and writes couplingÂ RedisÂ withÂ Neo4J. Now I want to share with you how it&rsquo;s possible to unload your server and use Elasticsearch to speed up news feed and user wall.
1/ Show me your news feed A news feed is the main page of traditional social networks. ItsÂ main goal is to showÂ you all recents updates from your friends and your interests.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Elasticsearch: How we speed up news feeds and user walls display">
    <meta property="og:url" content="/2016/01/20/how-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch/">
    <meta property="og:site_name" content="Deimosfr Blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Deimosfr Blog">
    <meta name="twitter:description" content="&nbsp;
In my previous post, I talked about how to speed up reads and writes couplingÂ RedisÂ withÂ Neo4J. Now I want to share with you how it&rsquo;s possible to unload your server and use Elasticsearch to speed up news feed and user wall.
1/ Show me your news feed A news feed is the main page of traditional social networks. ItsÂ main goal is to showÂ you all recents updates from your friends and your interests.">
    
      <meta name="twitter:creator" content="@deimosfr">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="https://deimosfr.github.io/blog/css/style-u6mk0ojoywresbx8iepslrmmhl4stuhrsxuwhkpwrkrx7mryjcaimasnk4pi.min.css" />
    
    
      <link rel="stylesheet" href="https://deimosfr.github.io/blog/css/custom.css">
    

    
      
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63927289-1', 'auto');
ga('send', 'pageview');
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="2">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://deimosfr.github.io/blog/">Deimosfr Blog</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://deimosfr.github.io/blog/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="2">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://deimosfr.github.io/blog/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Pierre Mavro / Deimosfr</h4>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://deimosfr.github.io/blog/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://deimosfr.github.io/blog/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://deimosfr.github.io/blog/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://deimosfr.github.io/blog/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://deimosfr.github.io/blog/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/deimosfr" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://fr.linkedin.com/in/pmavro" target="_blank">
    
      <i class="sidebar-button-icon fa fa-linkedin-square"></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://wiki.deimos.fr" target="_blank">
    
      <i class="sidebar-button-icon fa fa-wikipedia-w"></i>
      
      <span class="sidebar-button-desc">Wiki</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://deimosfr.github.io/blog/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="2"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Elasticsearch: How we speed up news feeds and user walls display
    </h1>
  
  <div class="postShorten-meta post-meta">
  
    <time itemprop="datePublished" datetime="2016-01-20T10:00:41Z">
      
  
  
  
  
    20 January 2016
  

    </time>
  
  
  
  
    <span>in</span>
    
      <a class="category-link" href="https://deimosfr.github.io/blog/categories/developement">Developement</a>, 
    
      <a class="category-link" href="https://deimosfr.github.io/blog/categories/nousmotards">Nousmotards</a>
    
  


</div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              

<p>&nbsp;</p>

<p>In <a href="https://blog.deimos.fr/2016/01/15/how-we-use-neo4j-on-our-social-network-and-workaround-performance-issues/" target="_blank">my previous post</a>, I talked about how to speed up reads and writes couplingÂ <a href="http://redis.io/" target="_blank">Redis</a>Â withÂ <a href="http://neo4j.com/" target="_blank">Neo4J</a>. Now I want to share with you how it&rsquo;s possible to <a href="https://en.wikipedia.org/wiki/Load_(computing)" target="_blank">unload your server</a> and use <a href="https://www.elastic.co/products/elasticsearch" target="_blank">Elasticsearch</a> to speed up news feed and user wall.</p>

<h3 id="1-show-me-your-news-feed">1/ Show me your news feed</h3>

<p>A news feed is the main page of traditional social networks. ItsÂ main goal is to showÂ you all recents updates from your friends and your interests. <a href="https://www.nousmotards.com" target="_blank">Nousmotards</a>Â news feed is like any otherÂ social networks (facebook, linkedin..), the user&rsquo;s feeds are available from their web browser and their <a href="https://play.google.com/store/apps/details?id=com.nousmotards.android" target="_blank">NM mobile application</a>Â and it looks like this.</p>

<p><img src="https://deimosfr.github.io/blog/images/Screen-Shot-2016-01-20-at-00.11.36-535x1024.png" alt="Screen-Shot-2016-01-20-at-00.11.36-535x1024" /></p>

<p><p style="text-align: center;">
  The web feed above, the android feed below</p>

<p><img src="https://deimosfr.github.io/blog/images/device-2016-01-20-003342-576x1024.png" alt="device-2016-01-20-003342-576x1024" /></p>

<p>&nbsp;</p>

<p>As a user, you want to <a href="https://en.wikipedia.org/wiki/EdgeRank" target="_blank">get the more relevant things</a>Â Â and the most updated posts from your friends. And while you are scrolling you want to have the best experience possible. Which means, no glitch/freeze from the UI, no latency while loading images and bunch of news.</p>

<p><img src="https://deimosfr.github.io/blog/images/more-to-less-relevant.png" alt="more-to-less-relevant" /></p>

<h3 id="2-first-attempt">2/ First attempt</h3>

<p>In our first approach <a href="https://blog.deimos.fr/2016/01/15/how-we-use-neo4j-on-our-social-network-and-workaround-performance-issues/" target="_blank">we were using directly Neo4J</a>Â to read data and display them to the users. Direct access to the database is expensive, 40 concurrent accesses and your server will become so slow than nobody will ever comeÂ back.</p>

<p><p class="p1">
  <span class="s1">The datas to retrieve are unique to each user because it depends of what they liked, the people they are &ldquo;friends&rdquo; with, getting the last relevant thingsâ€¦ Â These are <strong>contextual datas</strong> to retrieve for each users.</span></p>

<p><img src="https://deimosfr.github.io/blog/images/Screen-Shot-2016-01-19-at-12.18.32-1024x714.png" alt="Screen-Shot-2016-01-19-at-12.18.32-1024x714" /></p>

<p>I let you imagine the complexity of this, and the effort that the database has to do to respond to the 40 concurrent users, <strong>enrich</strong> them and serialize them all into <a href="https://en.wikipedia.org/wiki/JSON" target="_blank">JSON</a> before sending them to the requester. (note: red dots are users)</p>

<p>Enrichment is the process of setting some properties depending on who made theÂ request. For instance: Romaric has like a post from Pierre, Romaric request the server to have his feed page, he&rsquo;s retrieving the post that he liked in the same state. Pierre see that his post has been liked by Romaric.</p>

<p>&nbsp;</p>

<p>Enrichment processing is very expensive in time, and must be done for each document (10 documents per page) that you want to send to the requester.</p>

<p><img src="https://deimosfr.github.io/blog/images/enrichments-1.png" alt="enrichments-1" /></p>

<p>&nbsp;</p>

<p>4 requesters, 4 read queries in database, 40 enrichments which results to 40 read requests in database more.. server took at best 4 seconds to respond to each of them. Very bad for user experience.. More requesters you have, and more the service take time to respond.. latency ~= <a href="https://en.wikipedia.org/wiki/Big_O_notation" target="_blank">O(n^2)</a> where n is the number of simultaneous requesters..</p>

<h3 id="3-elasticsearch-to-the-rescue">3/ Elasticsearch to the rescue</h3>

<p><a href="https://en.wikipedia.org/wiki/Elasticsearch" target="_blank">Elasticsearch</a> is now a very popular documents store solution very used by <a href="https://en.wikipedia.org/wiki/DevOps" target="_blank">OPS</a>Â and developers. It&rsquo;s commonlyÂ used to store logs, search inside them, do sophisticatedÂ analytics.. Access times are very good and the product own large <a href="https://www.elastic.co/community" target="_blank">community</a> to make it evolving into the right direction.</p>

<p>In Nousmotards we are using it for log analytics, monitoring and above all as <strong>feeds and walls cache solution</strong> !</p>

<p>Instead of directly using Neo4J to ship documents to the user, we have placedÂ Elasticsearch between Neo4j and the &ldquo;core app&rdquo; to retrieve them, then enriching them from Redis before replyingÂ to the user<em>.</em></p>

<p><img src="https://deimosfr.github.io/blog/images/1-1.png" alt="1-1" /></p>

<p>&nbsp;</p>

<p>Neo4J disappear ? No it&rsquo;s justÂ not used anymore on read requests. Now with 40 concurrent requests we are around 200 and 300ms to reply, that&rsquo;s huge difference ! Neo4J is no more bother by users who get their last updates and can process write requests smoothly. (stats from yesterday, 41245 req, 260ms average request time)</p>

<p><img src="https://deimosfr.github.io/blog/images/Screen-Shot-2016-01-19-at-17.02.38-209x300.png" alt="Screen-Shot-2016-01-19-at-17.02.38-209x300" /></p>

<h3 id="4-to-conclude">4/ To conclude</h3>

<p>Elasticsearch is our life saver, we are using it for more and more things at Nousmotards. In the other hand, itÂ is not a database, you should not use it as your primary datastore ! Corrupt indices may happen and you should be able to reload all yourÂ data from scratch. If you know that, you can start to use it at its full potential and with noÂ fear to break things ðŸ˜‰</p>

<p>&nbsp;</p>

<p>sources:</p>

<ul>
<li><a href="http://kuhess.github.io/presentations/a-news-feed-with-elasticsearch/index.html#/" target="_blank">News feed with Elasticsearch @Viadeo</a></li>
<li><a href="http://activitystrea.ms/" target="_blank">Activity Stream</a></li>
<li><a href="https://code.facebook.com/posts/340384146140520/making-news-feed-nearly-50-faster-on-ios/" target="_blank">News feed performance on iOS @Facebook</a></li>
<li><a href="https://code.facebook.com/posts/879498888759525/fast-rendering-news-feed-on-android/" target="_blank">News feed performance on Android @Facebook</a></li>
</ul>

<p>To get more informations on nousmotards: <a href="http://blog.nousmotards.com" target="_blank">blog.nousmotards.com</a></p>

<p>Join us ! :-)</p>

<p><img src="https://deimosfr.github.io/blog/images/nm-app-all-screenshots-1024x292.png" alt="nm-app-all-screenshots-1024x292" /></p>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://deimosfr.github.io/blog//tags/nousmotards/">nousmotards</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://deimosfr.github.io/blog/2016/01/21/zero-downtime-upgrade-with-ansible-and-haproxy/" data-tooltip="Zero downtime upgrade with Ansible and HAProxy">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://deimosfr.github.io/blog/2016/01/15/how-we-use-neo4j-on-our-social-network-and-workaround-performance-issues/" data-tooltip="How we use Neo4J on our social network and workaround performance issues">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2017 Pierre Mavro / Deimosfr. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
        <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://deimosfr.github.io/blog/2016/01/21/zero-downtime-upgrade-with-ansible-and-haproxy/" data-tooltip="Zero downtime upgrade with Ansible and HAProxy">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://deimosfr.github.io/blog/2016/01/15/how-we-use-neo4j-on-our-social-network-and-workaround-performance-issues/" data-tooltip="How we use Neo4J on our social network and workaround performance issues">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="2">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
        <i class="fa fa-google-plus"></i><span>Share on Google Plus</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
        <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fdeimosfr.github.io%2fblog%2f2016%2f01%2f20%2fhow-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch%2f">
        <i class="fa fa-twitter"></i><span>Share on Twitter</span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/194382a6478d109ac45c9b11bad1945e?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Pierre Mavro / Deimosfr</h4>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        SRE Lead DevOps at Criteo
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Paris - France
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/09/30/deploy-coreos-with-ansible/">
                <h3 class="media-heading">Deploy CoreOS with Ansible</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">&nbsp;
CoreOS is a lightweight Linux operating system designed for clustered deployments providing automation, security, and scalability for your most critical applications.&nbsp;I&rsquo;ve been playing with CoreOS to replace Debian hosts which run Docker containers on Nousmotards project. CoreOS helps on simplifying bare metal deployment and avoid managing OS upgrade.
As I&rsquo;m still an Ansible lover, I&rsquo;ve made 2 roles:
 CoreOS Ansible:&nbsp;Ansible role to deploy pypy to CoreOS to be able to get Ansible prerequisites CoreOS: Ansible CoreOS role to deploy CoreOS on bare metal servers  The first one is&nbsp;for installing pypy to run Ansible and the other one to bootstrap CoreOS with Cloudinit or/and Igninition.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/06/18/do-not-waste-time-with-grep-anymore-use-tag/">
                <h3 class="media-heading">Do not waste time with grep anymore, use tag</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Long time since my last post. This one is not very technical post, but it&rsquo;s a nice to have solution if you use grep usually. Are not you fed up to type vim  and search the line after a grep command ? If yes, this post is for you.
First of all, you may know that an alternative more user friendly to grep exist, called ag (perf comparison). I really like ag and grep, but something make me loose my time since several years and I&rsquo;m pretty sure it&rsquo;s your case too.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/01/21/zero-downtime-upgrade-with-ansible-and-haproxy/">
                <h3 class="media-heading">Zero downtime upgrade with Ansible and HAProxy</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Some of you may not be familiar withÂ the terms &ldquo;Rolling upgrade&rdquo; or &ldquo;Rolling restart&rdquo;. This is the action ofÂ upgrading or restarting a cluster without service interruption (alias zero downtime). In most cases, this is done node by node, but in fact it depends of the technology you&rsquo;re managing and the number of active nodes in your cluster.
AtÂ NousmotardsÂ we have several Java Spring Boot applications running. Restarting one applicationÂ can take up to 1 min.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/01/20/how-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch/">
                <h3 class="media-heading">Elasticsearch: How we speed up news feeds and user walls display</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">&nbsp;
In my previous post, I talked about how to speed up reads and writes couplingÂ RedisÂ withÂ Neo4J. Now I want to share with you how it&rsquo;s possible to unload your server and use Elasticsearch to speed up news feed and user wall.
1/ Show me your news feed A news feed is the main page of traditional social networks. ItsÂ main goal is to showÂ you all recents updates from your friends and your interests.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/01/15/how-we-use-neo4j-on-our-social-network-and-workaround-performance-issues/">
                <h3 class="media-heading">How we use Neo4J on our social network and workaround performance issues</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Neo4J is the most popular graph database in the NoSQL databasesÂ family. We&rsquo;re using it in the Nousmotards projectÂ to store all socialÂ data through nodes and relationships.
Today I am going to talk about our experience after having using it for 2 years now (take a look atÂ directedÂ graphÂ if you are not really familiar with Graph Database).
1/ Our use case Nousmotards is a social network for bikers, we aim to provide valuable tools to ride, meet and share niceÂ time with people who like motorcycling.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/01/13/docker-why-you-should-use-monit-instead-of-supervisord/">
                <h3 class="media-heading">Docker: why you should use Monit instead of supervisord</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This title can sounds like a troll, but this is not the case! I&rsquo;m writing this post as a feedback. When I spoke during an Ansible meetup presenting Nousmotards infrastructure, I had several questions regarding why I chose monit as the init system instead of supervisord. That&rsquo;s what encouraged me to write this post and that&rsquo;s why I wanted to clarify here the things.
Introduction Docker is made to run a process in a confined area.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/01/08/graphite-events-on-debian-jessie/">
                <h3 class="media-heading">Graphite events on Debian jessie</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">I&rsquo;m using Graphite at work and for my Nousmotards project. For Nousmotards, I&rsquo;m using the Graphite version available in the default Debian Jessie repositories. This to avoid mismatch django dependencies etc&hellip;
A few days ago, I wanted to try Graphite events to get something pretty cool in Grafana :
This to be able to know when a new app version is deployed and make it easier to understand when an issue occurs.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2016/01/07/ansible-color-and-buffer-fix-on-jenkins/">
                <h3 class="media-heading">Ansible color and buffer fix on Jenkins</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Hi all ! Long time since last blog post ! I&rsquo;m using Jenkins with Ansible on my Nousmotards project for building docker containers or deploying into production.
You may noticed that you&rsquo;ve no Ansible color when running it into Jenkins! The simple way to correct it is to export an environment variable in your Jenkins job:
export ANSIBLE_FORCE_COLOR=true  Now that&rsquo;s pretty cool! However, you may also noticed that there&rsquo;s some kind of lags on the console when you want to see a real time console log on Jenkins.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2015/11/27/upgrading-ansible-consul-template-role/">
                <h3 class="media-heading">Upgrading Ansible Consul Template role</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">As I wanted to upgrade it and because it has been asked several time, I upgraded the consul-template Ansible role to manage official binaries (and upgrades). Here are the new vars:
consul_template_version: &#39;0.11.0&#39; consul_template_arch: &#39;linux_amd64&#39; consul_template_http_src: &quot;https://github.com/hashicorp/consul-template/releases/download/v{{consul_template_version}}/consul_template_{{consul_template_version}}_{{consul_template_arch}}.zip&quot;  You can of course find the role to Ansible Galaxy: https://galaxy.ansible.com/detail#/role/3451
I hope you&rsquo;ll enjoy this new version :-)</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://deimosfr.github.io/blog/2015/09/15/ansible-meetup-done-watch-again-the-slides/">
                <h3 class="media-heading">Ansible Meetup done! Watch again the slides</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">The Ansible meetup ended ! That was really nice for my first one.
I had really great feedbacks and liked the questions when ended. More than that I met nice people after the meetup and could have interresting discussions :-). I&rsquo;m really happy about it.
For those who would like to review the slides, you can find them here:
http://nousmotards.github.io/ansible-meetup-0915/
If you want to watch the video:
http://www.infoq.com/fr/presentations/reseau-social-motard
or view the PDF version here:</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         833 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://deimosfr.github.io/blog/images/fish_background.jpg');"></div>
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js"></script>


<script src="https://deimosfr.github.io/blog/js/script-wl33z0n6ocaypepiqrazthtivfrliqijej4rq8ek8gvrv1awftmgjuv8k4zc.min.js"></script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight').each(function(i, block) {
    var code = "";
    hljs.highlightAuto(block.innerText).value.split(/\r\n|\r|\n/).forEach(function(line) {
      code += "<span class=\"line\">" + line + "</span><br>";
    });
    if (code.length > 0) {
      block.innerHTML = code;  
    }
  });
  $('pre > code').each(function(i, block) {
    $(this).addClass('codeblock');
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/deimosfr.github.io\/blog\/2016\/01\/20\/how-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch\/';
          
            this.page.identifier = '\/2016\/01\/20\/how-we-speed-up-news-feed-and-user-wall-display-using-elasticsearch\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'blog-deimosfr';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  





    
  </body>
</html>

